{
  $schema: 'https://docs.renovatebot.com/renovate-schema.json',
  extends: [
    'config:best-practices',
    'config:semverAllMonthly',
    ':gitSignOff',
  ],
  dependencyDashboardTitle: 'Renovate Dashboard',
  assigneesFromCodeOwners: true,
  timezone: 'Europe/Paris',
  separateMajorMinor: true,
  flux: {
    fileMatch: [
      'kubernetes/.+/helm-?release\\.ya?ml$',
      'flux-system/.+\\.ya?ml$',
      'charts/.+\\.ya?ml$',
    ],
  },
  'helm-values': {
    fileMatch: [
      'kubernetes/.+/helm-?release\\.ya?ml$',
    ],
  },
  kubernetes: {
    fileMatch: [
      'kubernetes/.+\\.ya?ml$',
    ],
  },
  customManagers: [
    {
      customType: 'regex',
      description: [
        'Process custom dependencies',
      ],
      fileMatch: [
        '(^|/)ansible/.+\\.ya?ml(?:\\.j2)?$',
        '(^|/)kubernetes/.+\\.ya?ml(?:\\.j2)?$',
      ],
      matchStrings: [
        'datasource=(?<datasource>\\S+) depName=(?<depName>\\S+)( repository=(?<registryUrl>\\S+))?\\n.+: (&\\S+\\s)?(?<currentValue>\\S+)',
        'datasource=(?<datasource>\\S+) depName=(?<depName>\\S+)\\n.+/(?<currentValue>(v|\\d)[^/]+)',
      ],
      datasourceTemplate: '{{#if datasource}}{{{datasource}}}{{else}}github-releases{{/if}}',
    },
    {
      customType: 'regex',
      description: [
        'Process CloudnativePG Postgresql version',
      ],
      fileMatch: [
        '(^|/)kubernetes/.+\\.ya?ml(?:\\.j2)?$',
      ],
      matchStrings: [
        'imageName: (?<depName>\\S+):(?<currentValue>.*\\-.*)',
      ],
      datasourceTemplate: 'docker',
      versioningTemplate: 'redhat',
    },
  ],
  packageRules: [
    {
      matchManagers: [
        'kubernetes',
      ],
      matchDatasources: [
        'kubernetes-api',
      ],
      enabled: false,
    },
    {
      groupName: 'flux',
      matchPackageNames: [
        '/flux/',
      ],
    },
    {
      description: 'Add attention to potential breaking change on major update',
      matchUpdateTypes: [
        'major',
      ],
      commitMessagePrefix: '{{semanticCommitType}}({{semanticCommitScope}})!:',
    },
    {
      description: 'Automerge minor and patch',
      matchUpdateTypes: [
        'minor',
        'patch',
        'pin',
        'digest',
      ],
      automerge: true,
    },
    {
      description: [
        'Custom schedule for frequently updated packages',
      ],
      matchDatasources: [
        'docker',
        'helm',
      ],
      schedule: [
        'on the first day of the month',
      ],
      matchPackageNames: [
        '/minio/',
        '/reloader/',
      ],
    },
    {
      description: [
        'Custom versioning for k3s',
      ],
      matchDatasources: [
        'github-releases',
      ],
      versioning: 'regex:^v(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)(?<compatibility>\\+k3s)(?<build>\\d+)$',
      matchPackageNames: [
        '/k3s/',
      ],
    },
    {
      description: 'Use custom versioning for Minio',
      matchDepNames: [
        'quay.io/minio/minio',
        'quay.io/minio/mc',
      ],
      versioning: 'regex:^RELEASE\\.(?<major>\\d+)-(?<minor>\\d+)-(?<patch>\\d+)T.*Z$',
    },
  ],
}
