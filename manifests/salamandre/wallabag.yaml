---
# Source: common-app/templates/application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: salamandre-wallabag
  labels:    
    helm.sh/chart: common-app-0.0.1
    app.kubernetes.io/version: "0.0.1"
    app.kubernetes.io/managed-by: Helm
  annotations:
    sebtiz13.fr/host: bag.sebtiz13.fr
spec:
  project: cloud
  source:
    repoURL: https://gitlab.com/api/v4/projects/40446088/packages/helm/stable
    chart: wallabag
    targetRevision: 0.1.0
    helm:
      releaseName: wallabag
      values: |
        env:
          SYMFONY__ENV__DATABASE_DRIVER: pdo_pgsql
          SYMFONY__ENV__DOMAIN_NAME: https://bag.sebtiz13.fr
          SYMFONY__ENV__FOSUSER_REGISTRATION: "false"
          SYMFONY__ENV__SERVER_NAME: sebtiz13.fr
          TZ: Europe/Paris
        externalSecret:
          dataFrom:
          - extract:
              key: salamandre/wallabag/database
          enabled: true
          target:
            template:
              data:
                SYMFONY__ENV__DATABASE_HOST: '{{ .host }}'
                SYMFONY__ENV__DATABASE_NAME: '{{ .database }}'
                SYMFONY__ENV__DATABASE_PASSWORD: '{{ .password }}'
                SYMFONY__ENV__DATABASE_PORT: '{{ .port }}'
                SYMFONY__ENV__DATABASE_USER: '{{ .user }}'
              type: Opaque
        ingress:
          annotations:
            traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
            traefik.ingress.kubernetes.io/router.middlewares: traefik-redirect-https@kubernetescrd
          className: traefik
          enabled: true
          hosts:
          - host: bag.sebtiz13.fr
            paths:
            - path: /
              pathType: ImplementationSpecific
          tls:
          - hosts:
            - bag.sebtiz13.fr
            secretName: sebtiz13-fr-tls
        resources:
          limits:
            cpu: 600m
            memory: 384Mi
          requests:
            cpu: 10m
            memory: 128Mi
  destination:
    name: in-cluster
    namespace: wallabag
  syncPolicy:
    automated: 
      prune: true
      selfHeal: true
