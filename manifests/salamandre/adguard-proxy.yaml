---
# Source: common-app/templates/application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: salamandre-adguard-proxy
  labels:
    helm.sh/chart: common-app-0.0.1
    app.kubernetes.io/version: "0.0.1"
    app.kubernetes.io/managed-by: Helm
  annotations:
    sebtiz13.fr/host: dns.sebtiz13.fr
spec:
  project: infrastructure
  source:
    repoURL: https://gitlab.com/api/v4/projects/40446088/packages/helm/stable
    chart: adguard-proxy
    targetRevision: 1.0.0
    helm:
      releaseName: adguard-proxy
      values: |
        adguard:
          ip: 192.168.1.2
          port: 3000
        ingress:
          annotations:
            traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
          enabled: true
          hosts:
          - host: dns.sebtiz13.fr
            paths:
            - path: /
              pathType: ImplementationSpecific
          - host: '*.dns.sebtiz13.fr'
            paths:
            - path: /
              pathType: ImplementationSpecific
          tls:
          - hosts:
            - dns.sebtiz13.fr
            - '*.dns.sebtiz13.fr'
            secretName: sebtiz13-fr-tls
  destination:
    name: in-cluster
    namespace: adguard
  syncPolicy:
    automated: 
      prune: true
      selfHeal: true    
    syncOptions:
      - CreateNamespace=true
