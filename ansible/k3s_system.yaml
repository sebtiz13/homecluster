- name: Deploy common system applications
  hosts: all
  tags: kubernetes
  roles:
    - role: apps_system
      delegate_to: localhost
      tags: common

- name: Deploy salamandre applications
  hosts: salamandre
  tags: kubernetes
  roles:
    - role: apps_vault
      delegate_to: localhost
      tags: vault
  post_tasks:
    - name: Create vault access
      delegate_to: localhost
      ansible.builtin.import_tasks: tasks/s_vault_access.yaml
    - name: Deploy cert-manager
      delegate_to: localhost
      tags:
        - cert-manager
        - tls
      ansible.builtin.import_tasks: tasks/s_cert-manager.yaml

- name: Deploy baku applications
  hosts: baku
  tags: kubernetes
  tasks:
    - name: Vault | Configure access
      delegate_to: localhost
      tags: vault
      ansible.builtin.import_tasks: tasks/b_vault.yaml

- name: Configure external-secrets
  hosts: all
  tags:
    - kubernetes
    - external-secrets
  roles:
    - role: apps_external-secrets
      delegate_to: localhost
