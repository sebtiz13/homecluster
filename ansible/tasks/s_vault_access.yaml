- name: Vault | Generate token
  vars:
    vault_file: "{{ lookup('ansible.builtin.file', credentials_folder + '/vault.json') }}"
  community.hashi_vault.vault_token_create:
    url: "{{ vault_host }}"
    validate_certs: false
    token: "{{ vault_file.root_token }}"
    ttl: 1h
  register: vault_token

- name: Vault | Store token in facts
  ansible.builtin.set_fact:
    ansible_hashi_vault_addr: "{{ vault_host }}"
    ansible_hashi_vault_token: "{{ vault_token.login.auth.client_token }}"
