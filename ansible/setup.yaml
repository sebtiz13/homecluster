- name: Install common requirement and create namespaces
  hosts: all
  tags: common
  roles:
    - role: common
      become: true

- name: Install sensors
  hosts: salamandre
  roles:
    - role: salamandre_sensors
      when: motherboard_chip is defined
      connection: ssh
      become: true
      tags: sensors

- name: Install and Configure DynDNS
  hosts: baku
  become: true
  tags: dyndns
  tasks:
    - name: DynDNS | Install client package
      when: env == 'production'
      ansible.builtin.apt:
        pkg:
          - ddclient

    - name: DynDNS | Configure it
      when: env == 'production'
      vars:
        username: "{{ dyndns.username }}"
        password: "{{ dyndns.password }}"
        domain: "{{ dyndns.domain }}"
      ansible.builtin.template:
        dest: /etc/ddclient.conf
        src: b_ddclient.conf.j2
        mode: "u=rwx,g=rx,o=rx"
        backup: true
