- name: Wait until traefik namepace exist
  kubernetes.core.k8s_info:
    kubeconfig: '{{ kubeconfig.dest }}'
    kind: Namespace
    name: traefik
    wait: true

- name: Deploy secret manifest
  vars:
    htpasswd: "{{ lookup('ansible.builtin.template', 'htpasswd.j2') }}"
  kubernetes.core.k8s:
    kubeconfig: '{{ kubeconfig.dest }}'
    state: present
    template: 'secret.yaml.j2'

- name: Deploy middleware manifest
  kubernetes.core.k8s:
    kubeconfig: '{{ kubeconfig.dest }}'
    state: present
    src: 'middleware.yaml'
