- name: Deploy secret manifest
  vars:
    htpasswd: "{{ lookup('ansible.builtin.template', 'htpasswd.j2') }}"
  kubernetes.core.k8s:
    kubeconfig: "{{ local_kubeconfig }}"
    state: present
    template: "secret.yaml.j2"

- name: Deploy middleware manifest
  kubernetes.core.k8s:
    kubeconfig: "{{ local_kubeconfig }}"
    state: present
    template: "middleware.yaml.j2"
