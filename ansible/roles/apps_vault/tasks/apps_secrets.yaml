- name: Fill OVH credentials (prod)
  no_log: true
  when: env == 'production'
  ansible.builtin.uri:
    url: "{{ vault_api_url }}/salamandre/data/cert-manager/ovh"
    method: POST
    status_code:
      - 204 # When successfull
      - 200 # When warning
    body_format: json
    headers:
      X-Vault-Token: "{{ vault_root_token }}"
    body:
      data:
        applicationKey: "{{ cert_manager_ovh_auth.application_key }}"
        applicationSecret: "{{ cert_manager_ovh_auth.application_secret }}"
        consumerKey: "{{ cert_manager_ovh_auth.consumer_key }}"

- name: Fill SMTP credentials
  no_log: true
  ansible.builtin.uri:
    url: "{{ vault_api_url }}/salamandre/data/smtp"
    method: POST
    status_code:
      - 204 # When successfull
      - 200 # When warning
    body_format: json
    headers:
      X-Vault-Token: "{{ vault_root_token }}"
    body:
      data: "{{ smtp_auth }}"
