- name: Download MinIO client
  ansible.builtin.get_url:
    url: https://dl.min.io/client/mc/release/linux-amd64/mc
    dest: "{{ exec_dir }}/mc"
    mode: "u=rwx,g=rx,o=rx"

- name: Create folder for MinIO config
  ansible.builtin.file:
    state: directory
    path: "{{ exec_dir }}/.mc"
    owner: backup
    group: backup
    mode: "0750" # u=rwx,g=rx

- name: Upload MinIO config
  vars:
    url: "{{ backup_s3.data.data.data.endpoint }}"
    access_key: "{{ backup_s3.data.data.data.accessKey }}"
    secret_key: "{{ backup_s3.data.data.data.secretKey }}"
  ansible.builtin.template:
    dest: "{{ exec_dir }}/.mc/config.json"
    src: mc_config.json.j2
    mode: "0640" # u=rw,g=r
