- name: OpenEBS | Wait until is started
  delegate_to: localhost
  tags: vault
  kubernetes.core.k8s_info:
    kubeconfig: "{{ local_kubeconfig }}"
    kind: DeamonSet
    name: openebs-zfs-localpv-node
    namespace: kube-system
    wait: true
    wait_sleep: 10
    wait_timeout: 360

- name: OpenEBS | Deploy storage classes
  vars:
    pool_name: "{{ zfs_pool.name | default('data') }}"
  kubernetes.core.k8s:
    kubeconfig: "{{ local_kubeconfig }}"
    state: present
    template: "openebs/{{ item }}.yaml.j2"
  loop:
    - zfspv
    - zfspv-block

- name: OpenEBS | Deploy snapshot class
  kubernetes.core.k8s:
    kubeconfig: "{{ local_kubeconfig }}"
    state: present
    src: openebs_zfspv-snapclass.yaml
