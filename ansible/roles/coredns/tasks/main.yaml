- name: Configure custom DNS
  vars:
    server_ip: '{{ ansible_eth0.ipv4.address }}'
    base_domain: '{{ domain_name }}'
    server:
      loc: "{{ lookup('ansible.builtin.template', 'loc.j2') }}"
      domain: "{{ lookup('ansible.builtin.template', 'domain.j2') }}"
  kubernetes.core.k8s:
    kubeconfig: '{{ kubeconfig.dest }}'
    state: present
    template: config_map.yaml.j2
    validate:
      fail_on_error: true
