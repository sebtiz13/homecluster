- name: Install common requirement and create namespaces
  hosts: all
  tags: common
  roles:
    - role: common
      become: true
  tasks:
    - name: Load applications admin passwords
      ansible.builtin.include_vars:
        file: "{{ credentials_folder }}/admin_passwords.yaml"
        name: admin_passwords

- name: Deploy salamandre
  ansible.builtin.import_playbook: salamandre.yaml

- name: Deploy Baku
  ansible.builtin.import_playbook: baku.yaml

- name: Configure backup
  hosts: salamandre
  become: true
  tags:
    - backup
    - minio
  roles:
    - role: backup
      when: "(ansible_limit is not defined) or ('baku' in ansible_limit)"
