priorityClassName: system-cluster-critical

ingressClass:
  enabled: true
  isDefaultClass: true

providers:
  kubernetesIngress:
    publishedService:
      enabled: true

env:
  - name: TZ
    value: Europe/Paris

ports:
  minio:
    port: 3882
    expose: true
    exposedPort: 3882
    protocol: TCP
    tls:
      enabled: true
  monitoring:
    port: 53639
    expose: true
    exposedPort: 53639
    protocol: TCP
    tls:
      enabled: true

metrics:
  prometheus:
    service:
      enabled: true
    serviceMonitor:
      enabled: true
      jobLabel: traefik
      honorLabels: true

{{- $domainName := .Values.baseDomain | replace "." "-" }}
extraObjects:
  - apiVersion: traefik.io/v1alpha1
    kind: Middleware
    metadata:
      name: redirect-https
    spec:
      redirectScheme:
        scheme: https
        permanent: true
  - apiVersion: traefik.io/v1alpha1
    kind: TLSStore
    metadata:
      name: default
    spec:
      defaultCertificate:
        secretName: {{ $domainName }}-tls
  - apiVersion: external-secrets.io/v1beta1
    kind: ExternalSecret
    metadata:
      name: {{ $domainName }}-tls
    spec:
      secretStoreRef:
        name: vault-eso
        kind: ClusterSecretStore
      refreshInterval: 1h
      target:
        template:
          type: kubernetes.io/tls
          data:
            tls.crt: '{{`{{"{{ .crt }}"}}`}}'
            tls.key: '{{`{{"{{ .key }}"}}`}}'
      dataFrom:
        - extract:
            key: "salamandre/tls/{{ $domainName }}"
