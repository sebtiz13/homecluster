nextcloud:
  ingress:
    annotations:
      {{/* include "ingress.annotations.httpsRedirect" . | nindent 6 */}}
      traefik.ingress.kubernetes.io/router.middlewares: traefik-redirect-https@kubernetescrd,nextcloud-chained-middlewares@kubernetescrd
      traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
    tls:
      - secretName: {{ include "ingress.tls.secretName" . }}
        hosts:
          - {{ include "ingress.host" . }}

  nextcloud:
    host: {{ include "ingress.host" . }}
    username: <path:salamandre/data/nextcloud/auth#adminUser>
    password: <path:salamandre/data/nextcloud/auth#adminPassword>

    configs:
      custom.config.php: |-
        <?php
        $$CONFIG = array (
          'default_phone_region' => 'FR'
        );

    mail:
      enabled: true
      fromAddress: contact
      domain: {{ .Values.baseDomain }}
      smtp:
        host: <path:salamandre/data/smtp#host>
        port: <path:salamandre/data/smtp#port>

  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 1500m
      memory: 2Gi

  externalDatabase:
    enabled: true
    type: postgresql
    host: <path:salamandre/data/nextcloud/database#host>:<path:salamandre/data/nextcloud/database#port>
    database: <path:salamandre/data/nextcloud/database#database>
    user: <path:salamandre/data/nextcloud/database#user>
    password: <path:salamandre/data/nextcloud/database#password>

  persistence:
    enabled: true
    nextcloudData:
      enabled: true
      size: 50Gi

  metrics:
    # fix token (prevent diff on ArgoCD)
    token: nextcloud-token

collabora-code:
  collabora:
    aliasgroups:
      - domain: https://{{ include "ingress.host" . }}
    server_name: {{ include "ingress.host" . }}

    dictionaries: en_GB en_US fr_FR

    username: <path:salamandre/data/nextcloud/auth#collaboraAdminUser>
    password: <path:salamandre/data/nextcloud/auth#collaboraAdminPassword>
