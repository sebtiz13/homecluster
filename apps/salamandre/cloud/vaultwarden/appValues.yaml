vaultwarden:
  tz: Europe/Paris

  domain: https://{{ include "ingress.host" . }}

  sends_allowed: true
  user_attachment_limit: -1
  org_attachment_limit: -1

  trash_auto_delete_days: 30

  signups_allowed: false

  disable_admin_token: true

ingress:
  enabled: true
  className: traefik

  annotations:
    {{ include "ingress.annotations.httpsRedirect" . | nindent 4 }}

  tls:
    - hosts:
        - {{ include "ingress.host" . }}

  admin:
    enabled: true

    annotations:
      traefik.ingress.kubernetes.io/router.middlewares: traefik-admin-auth@kubernetescrd
      traefik.ingress.kubernetes.io/router.entrypoints: websecure

database:
  type: postgresql
  existingSecret: vaultwarden-db-credentials

smtp:
  enabled: true
  existingSecret: vaultwarden-smtp

securityContext:
  enabled: true

external-secrets:
  secrets:
    - name: smtp
      target:
        template:
          type: Opaque
          data:
            SMTP_HOST: '{{`{{ .host }}`}}'
            SMTP_PORT: '{{`{{ .port }}`}}'
            SMTP_FROM: '{{`{{ .username }}`}}'
            SMTP_SECURITY: starttls
            SMTP_USERNAME: '{{`{{ .username }}`}}'
            SMTP_PASSWORD: '{{`{{ .password }}`}}'
      dataFrom:
        - extract:
            key: salamandre/smtp
    - name: db-credentials
      target:
        template:
          type: Opaque
          data:
            DATABASE_URL: '{{`postgresql://{{ .user }}:{{ .password }}@{{ .host }}:{{ .port }}/{{ .database }}`}}'
      dataFrom:
        - extract:
            key: salamandre/nextcloud/database
