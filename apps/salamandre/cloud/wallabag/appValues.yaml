env:
  TZ: Europe/Paris
  SYMFONY__ENV__DOMAIN_NAME: https://{{ include "ingress.host" . }}
  SYMFONY__ENV__SERVER_NAME: {{ .Values.baseDomain }}
  SYMFONY__ENV__FOSUSER_REGISTRATION: 'false'
  SYMFONY__ENV__DATABASE_DRIVER: pdo_pgsql

ingress:
  enabled: true
  className: traefik
  annotations:
    {{ include "ingress.annotations.httpsRedirect" . | nindent 4 }}

  hosts:
    - host: {{ include "ingress.host" . }}
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls:
    - secretName: {{ include "ingress.tls.secretName" . }}
      hosts:
        - {{ include "ingress.host" . }}

resources:
  requests:
    cpu: 10m
    memory: 128Mi
  limits:
    cpu: 600m
    memory: 384Mi

externalSecret:
  enabled: true

  target:
    template:
      type: Opaque
      data:
        SYMFONY__ENV__DATABASE_HOST: '{{`{{ .host }}`}}'
        SYMFONY__ENV__DATABASE_PORT: '{{`{{ .port }}`}}'
        SYMFONY__ENV__DATABASE_NAME: '{{`{{ .database }}`}}'
        SYMFONY__ENV__DATABASE_USER: '{{`{{ .user }}`}}'
        SYMFONY__ENV__DATABASE_PASSWORD: '{{`{{ .password }}`}}'
  dataFrom:
    - extract:
        key: salamandre/wallabag/database
