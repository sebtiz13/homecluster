cert-manager:
  global:
    priorityClassName: "system-cluster-critical"

  installCRDs: true

  resources:
    requests:
      cpu: 10m
      memory: 32Mi

cert-manager-webhook-ovh:
  groupName: {{ .Values.baseDomain }}

  resources:
    requests:
      cpu: 30m
      memory: 32Mi
    limits:
      cpu: 200m
      memory: 256Mi

{{ $domainName := .Values.baseDomain | replace "." "-" }}
certificates:
  - name: {{ $domainName }}
    issuerName: {{ $domainName }}-issuer
    dnsNames:
      - "{{ .Values.baseDomain }}"
      - "*.{{ .Values.baseDomain }}"
      - "console.s3.{{ .Values.baseDomain }}"
    secretTemplate:
      annotations:
        kubed.appscode.com/sync: "domain={{ .Values.baseDomain }}"
        kubed.appscode.com/sync-contexts: baku
      labels:
        domain: {{ $domainName }}
  - name: "pages-{{ $domainName }}"
    issuerName: {{ $domainName }}-issuer
    dnsNames:
      - "pages.{{ .Values.baseDomain }}"
      - "*.pages.{{ .Values.baseDomain }}"
    secretTemplate:
      annotations:
        kubed.appscode.com/sync: "kubernetes.io/metadata.name=gitlab"
      labels:
        domain: "pages-{{ $domainName }}"
  - name: "dns-{{ $domainName }}"
    issuerName: {{ $domainName }}-issuer
    dnsNames:
      - "dns.{{ .Values.baseDomain }}"
      - "*.dns.{{ .Values.baseDomain }}"
    secretTemplate:
      annotations:
        kubed.appscode.com/sync: "kubernetes.io/metadata.name=adguard"
      labels:
        domain: "dns-{{ $domainName }}"

extraObjects:
  - apiVersion: cert-manager.io/v1
    kind: ClusterIssuer
    metadata:
      name: letsencrypt-prod
    spec:
      acme:
        # The ACME server URL
        server: https://acme-v02.api.letsencrypt.org/directory
        # Email address used for ACME registration
        email: contact@sebtiz13.fr
        # Name of a secret used to store the ACME account private key
        privateKeySecretRef:
          name: letsencrypt-prod
        preferredChain: "ISRG Root X1"
        # Enable the HTTP-01 challenge provider
        solvers:
        - http01:
            ingress:
              ingressTemplate:
                metadata:
                  annotations:
                    traefik.ingress.kubernetes.io/router.entrypoints: web
  - apiVersion: cert-manager.io/v1
    kind: ClusterIssuer
    metadata:
      name: letsencrypt-staging
    spec:
      acme:
        # The ACME server URL
        server: https://acme-staging-v02.api.letsencrypt.org/directory
        # Email address used for ACME registration
        email: sebtiz13@gmail.com
        # Name of a secret used to store the ACME account private key
        privateKeySecretRef:
          name: letsencrypt-staging
        preferredChain: "ISRG Root X1"
        # Enable the HTTP-01 challenge provider
        solvers:
        - http01:
            ingress:
              ingressTemplate:
                metadata:
                  annotations:
                    traefik.ingress.kubernetes.io/router.entrypoints: web
