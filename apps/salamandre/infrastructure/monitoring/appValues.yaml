external-secrets:
  secrets:
    - name: credentials
      target:
        template:
          type: Opaque
          data:
            user: '{{`{{ .vmsingleUser }}`}}'
            password: '{{`{{ .vmsinglePassword }}`}}'
      dataFrom:
        - extract:
            key: baku/monitoring/auth

victoria-metrics-k8s-stack:
  # victoria-metrics-operator: # TODO: fix that when have better serviceaccount stuff
  #   watchNamespace: {{ .Values.destination.namespace | quote }}

  externalVM:
    read:
      url: https://{{ include "ingress.host" . }}:{{ .Values.ingress.port }}/
      basicAuth: {{ .Values.basicAuth | toYaml | nindent 8 }}
    write:
      url: https://{{ include "ingress.host" . }}:{{ .Values.ingress.port }}/api/v1/write
      basicAuth: {{ .Values.basicAuth | toYaml | nindent 8 }}

  vmagent:
    spec:
      externalLabels:
        cluster: salamandre

  {{/* disable uneeded dependencies */}}
  defaultRules:
    create: false
  vmalert:
    enabled: false
  vmsingle:
    enabled: false
  alertmanager:
    enabled: false

{{/* disable uneeded dependencies */}}
defaultRules:
  create: false
grafana:
  enabled: false
