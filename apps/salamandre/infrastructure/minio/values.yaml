plugin: argocd-vault-plugin-helm

ingress:
  subdomain: s3

source:
  repoURL: https://charts.min.io/
  chart: minio
  targetRevision: 5.0.7

destination:
  namespace: minio

syncPolicy:
  automated:
    prune: true
    selfHeal: true

# App Values
buckets:
  - name: <path:salamandre/data/gitlab/s3#bucket_artifacts>
    policy: none
  - name: <path:salamandre/data/gitlab/s3#bucket_backups>
    policy: none
  - name: <path:salamandre/data/gitlab/s3#bucket_depsProxy>
    policy: none
  - name: <path:salamandre/data/gitlab/s3#bucket_packages>
    policy: none
  - name: <path:salamandre/data/gitlab/s3#bucket_pages>
    policy: none
  - name: <path:salamandre/data/gitlab/s3#bucket_registry>
    policy: none
  - name: <path:salamandre/data/gitlab/s3#bucket_runner>
    policy: none
  - name: <path:salamandre/data/gitlab/s3#bucket_tfState>
    policy: none
  - name: <path:salamandre/data/gitlab/s3#bucket_uploads>
    policy: none
  - name: <path:salamandre/data/gitlab/s3#bucket_lfs>
    policy: none

serviceAccounts:
  - accessKey: <path:salamandre/data/gitlab/s3#accessKey>
    secretKey: <path:salamandre/data/gitlab/s3#secretKey>
    user: <path:salamandre/data/minio/auth#rootUser>
    policy:
      statements:
        - actions:
            - s3:GetBucketLocation
            - s3:ListBucket
            - s3:ListBucketMultipartUploads
          resources:
            - arn:aws:s3:::gitlab-*
            - arn:aws:s3:::git-lfs
            - arn:aws:s3:::tmp
        - actions:
            - s3:AbortMultipartUpload
            - s3:ListMultipartUploadParts
            - s3:PutObject
            - s3:GetObject
            - s3:DeleteObject
            - s3:GetBucketPolicy # s3:GetObjectAcl
            - s3:PutBucketPolicy # s3:PutObjectAcl
          resources:
            - arn:aws:s3:::gitlab-*/*
            - arn:aws:s3:::git-lfs/*
            - arn:aws:s3:::tmp/*
