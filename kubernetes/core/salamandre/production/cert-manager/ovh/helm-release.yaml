---
# yaml-language-server: $schema=https://raw.githubusercontent.com/fluxcd-community/flux2-schemas/main/helmrelease-helm-v2beta2.json
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: &name cert-manager-webhook-ovh
  namespace: &ns cert-manager
spec:
  releaseName: *name
  interval: 1h
  chart:
    spec:
      chart: cert-manager-webhook-ovh
      version: "1.13.3"
      sourceRef:
        kind: HelmRepository
        name: *name
        namespace: flux-system
  values:
    groupName: ${DOMAIN_NAME}

    resources:
      requests:
        cpu: 30m
        memory: 32Mi
      limits:
        cpu: 200m
        memory: 256Mi

    issuers:
      - name: ${DOMAIN_NAME/./-}-issuer
        kind: ClusterIssuer
        create: true
        namespace: *ns
        server: https://acme-v02.api.letsencrypt.org/directory
        email: "contact@${DOMAIN_NAME}"
        ovhEndpointName: ovh-eu
        ovhAuthenticationRef:
          applicationKey:
            name: ovh-credentials
            key: applicationKey
          applicationSecret:
            name: ovh-credentials
            key: applicationSecret
          consumerKey:
            name: ovh-credentials
            key: consumerKey
