{{- range .Values.secrets }}
{{ $secretStoreRef := default $.Values.secretStoreRef .secretStoreRef }}
{{ $refreshInterval := default $.Values.refreshInterval .refreshInterval }}
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: "{{ include "external-secrets.fullname" $ }}-{{ .name }}"
  {{- with .annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
  labels:
    {{- include "external-secrets.labels" $ | nindent 4 }}
spec:
  secretStoreRef:
    name: {{ $secretStoreRef.name | quote }}
    kind: {{ $secretStoreRef.kind | quote }}
  {{- if $refreshInterval }}
  refreshInterval: {{ $refreshInterval | quote }}
  {{- end }}
  target:
    {{- with .target }}
    {{- if .name }}
    name: {{ .name }}
    {{- end -}}
    {{- if .creationPolicy }}
    creationPolicy: {{ .creationPolicy }}
    {{- end -}}
    {{- if .deletionPolicy }}
    deletionPolicy: {{ .deletionPolicy }}
    {{- end -}}
    {{- if .template }}
    template:
      {{- toYaml .template | nindent 6 }}
    {{- end -}}
    {{ end }}
  {{- if .data }}
  data:
    {{- toYaml .data | nindent 4 }}
  {{- end }}
  dataFrom:
    {{- toYaml .dataFrom | nindent 4 }}
{{- end -}}
