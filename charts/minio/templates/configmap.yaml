apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "minio.fullname" .Subcharts.minio }}-2
  namespace: {{ .Release.Namespace | quote }}
  labels:
    app: {{ template "minio.name" .Subcharts.minio }}
    chart: {{ template "minio.chart" .Subcharts.minio }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
data:
{{- range $idx, $svc := .Values.svcaccts }}
{{- if $svc.policy }}
  # SVC: {{ $svc.accessKey }}
  svc_policy_{{ $idx }}.json: |-
{{ include (print $.Template.BasePath "/_helper_policy.tpl") .policy | indent 4 }}
{{- end }}
{{ end }}
  add-svcacct: |-
{{ include (print $.Template.BasePath "/_helper_create_svcacct.txt") . | indent 4 }}
